<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastre-se como cliente | Help Floripa</title>
  <meta name="description" content="Cadastre-se como profissional na Help Floripa e ofereça seus serviços em Florianópolis e São José. Ganhe visibilidade, receba pedidos de clientes e aumente sua renda.">
  <meta name="keywords" content="cadastrar profissional, diarista, encanador, trabalhar Florianópolis, Help Floripa, serviços, autônomo, renda extra, prestador de serviços">
  <meta name="author" content="Help Floripa">
  <link rel="stylesheet" href="style.css">

  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1279593590387539');
  fbq('track', 'PageView');
  fbq('track', 'cadastrar');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=1279593590387539&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0a2a47;
      color: #fff;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background-color: #111;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    h1 {
      text-align: center;
      color: #00adee;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: none;
      border-radius: 8px;
      background-color: #222;
      color: #fff;
    }
    textarea {
      resize: vertical;
    }
    button {
      background-color: #00adee;
      color: white;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 8px;
      margin-top: 20px;
      cursor: pointer;
      font-weight: bold;
    }
    #apartamentoInfo, #regiaoContainer {
      display: none;
    }
    .termosContainer {
      display: flex;
      align-items: center;
      margin-top: 20px;
    }
    .termosContainer input[type="checkbox"] {
      margin-right: 10px;
    }
    #statusCadastro {
      margin-top: 16px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #1d3b52;
      background: #0f2233;
      font-size: 14px;
      line-height: 1.4;
      display: none;
    }
    #statusCadastro.show {
      display: block;
    }
    #statusCadastro.success {
      border-color: #1f7a47;
      background: #0f2f1d;
      color: #bdf5d2;
    }
    #statusCadastro.error {
      border-color: #8e2a2a;
      background: #351616;
      color: #ffd1d1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cadastrar como Profissional</h1>
    <form id="cadastrarForm">
      <label for="nome">Nome Completo:</label>
      <input type="text" id="nome" name="nome" required>

      <label for="classe">Área de Atuação:</label>
      <select id="classe" name="classe" required>
        <option value="">Selecione</option>
        <option value="construcaoreforma">Construção & Reforma</option>
        <option value="limpezacuidados">Limpeza & Cuidados</option>
        <option value="assistenciapessoal">Assistência Pessoal</option>
        <option value="transportelogistica">Transporte & Logística</option>
        <option value="petanimais">Pet & Animais</option>
        <option value="outros">Digital / Outros</option>
      </select>

      <label for="especialidade">Especialidade:</label>
      <select id="especialidade" name="especialidade" required>
        <option value="">Selecione uma classe primeiro</option>
      </select>

      <label for="cidade">Cidade:</label>
      <select id="cidade" name="cidade" required>
        <option value="">Selecione</option>
        <option value="florianopolis">Florianópolis</option>
        <option value="saojose">São José</option>
      </select>

      <div id="regiaoContainer">
        <label for="regiao">Região do Bairro (Florianópolis):</label>
        <select id="regiao" name="regiao">
          <option value="">Selecione</option>
          <option value="norte">Norte</option>
          <option value="sul">Sul</option>
          <option value="leste">Leste</option>
          <option value="continental">Continental</option>
          <option value="central">Central</option>
        </select>
      </div>

      <label for="bairro">Bairro:</label>
      <select id="bairro" name="bairro" required>
        <option value="">Selecione a cidade primeiro</option>
      </select>

      <label for="residencia">Tipo de Residência:</label>
      <select id="residencia" name="residencia" required>
        <option value="">Selecione</option>
        <option value="casa">Casa</option>
        <option value="apartamento">Apartamento</option>
      </select>

      <div id="apartamentoInfo">
        <label for="complemento">Número do Apartamento:</label>
        <input type="text" id="complemento" name="complemento" placeholder="Ex: Bloco B, Apto 203">
      </div>

      <label for="rua">Rua:</label>
      <input type="text" id="rua" name="rua" required>

      <label for="numero">Número:</label>
      <input type="text" id="numero" name="numero" required>

      <label for="telefone">Telefone para Contato:</label>
      <input type="tel" id="telefone" name="telefone" placeholder="(DDD) 90000-0000" required>

      <label for="email">E-mail:</label>
      <input type="email" id="email" name="email" placeholder="seunome@email.com" required>

      <label for="senha">Senha:</label>
      <input type="password" id="senha" name="senha" minlength="6" placeholder="Mínimo 6 caracteres" required>

      <label for="disponibilidade">Disponibilidade:</label>
      <input type="text" id="disponibilidade" name="disponibilidade" placeholder="Dias e horários disponíveis" required>

      <label for="descricao">Breve descrição ou experiência:</label>
      <textarea id="descricao" name="descricao" rows="4" required></textarea>

      <!-- Novo campo de diária mínima e máxima -->
      <label for="diaria">Valor da Diária (mínimo e máximo):</label>
      <input type="text" id="diaria" name="diaria" placeholder="Ex: R$ 120 - R$ 200 (Que você cobra)" required>

      <!-- Checkbox para aceitar os termos de uso -->
      <div class="termosContainer">
        <input type="checkbox" id="aceiteTermos" required>
        <label for="aceiteTermos" style="margin:0;">Li e concordo com os <a href="termos.html" target="_blank" style="color:#00adee;">Termos de Uso</a></label>
      </div>

      <button type="submit">Cadastrar</button>
      <button type="button" onclick="history.back()" style="margin-bottom: 20px; background-color: transparent; border: 2px solid #00adee; color: #00adee; padding: 10px 20px; border-radius: 8px; cursor: pointer;">← Voltar</button>
      <div id="statusCadastro" role="status" aria-live="polite"></div>
    </form>
  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const especialidadesPorClasse = {
      construcaoreforma: ["Eletricista","Encanador","Pedreiro","Pintor","Gesseiro","Marceneiro","Vidraceiro","Serralheiro","Servente de obra","Técnico de ar-condicionado","Montador de móveis"],
      limpezacuidados: ["Diarista / Limpeza","Faxineira pós-obra","Jardineiro","Piscineiro","Limpeza de estofados","Babá / Cuidadora infantil","Cuidadora de idosos","Cuidadora pós-parto / cirurgia", "Passadeira"],
      assistenciapessoal: ["Acompanhante hospitalar","Massoterapeuta","Cabeleireiro a domicílio","Maquiador(a)","Esteticista"],
      transportelogistica: ["Motorista particular","Motoboy","Carreteiro/frete pequeno","Montador / Desmontador de mudança"],
      petanimais: ["Dog walker (passeador de cães)","Pet sitter (cuidador de pets)","Banho e tosa em domicílio"],
      outros: ["Técnico de informática","Instalador de câmeras ou alarme","Professor particular (reforço escolar)","Tradutor/intérprete","Personal trainer"]
    };

    const bairrosPorRegiao = {
      central: ["Agronômica", "Centro", "José Mendes", "Saco dos Limões", "Trindade", "Pantanal","Itacorubi", "Córrego Grande", "Santa Mônica", "Parque São Jorge", "Monte Verde", "João Paulo"],
      norte: ["Canasvieiras", "Cachoeira do Bom Jesus", "Ingleses do Rio Vermelho", "Jurerê", "Jurerê Internacional","Praia Brava", "Ponta das Canas", "Sambaqui", "Santo Antônio de Lisboa", "Vargem Grande", "Vargem Pequena"],
      leste: ["Lagoa da Conceição", "Barra da Lagoa", "Rio Vermelho"],
      sul: ["Armação", "Campeche", "Carianos", "Caieira da Barra do Sul", "Costa de Dentro", "Costa de Cima", "Lagoa do Peri", "Pântano do Sul", "Ribeirão da Ilha", "Tapera"],
      continental: ["Abraão", "Balneário", "Capoeiras", "Coqueiros", "Estreito", "Itaguaçu", "Jardim Atlântico","Monte Cristo", "Santa Luzia", "Serrinha", "Vila Aparecida", "Bom Abrigo", "Coloninha"]
    };

    const bairrosSaoJose = ["Areias", "Barreiros", "Campinas", "Centro", "Forquilhas", "Ipiranga", "Itinga", "Kobrasol","Picadas do Sul", "Roçado", "Serraria", "Potecas", "Praia Comprida", "Real Parque","Floresta", "Jardim Cidade de Florianópolis", "Nossa Senhora do Rosário", "Sertão do Maruim","Sertão do Imaruim", "Colônia Santana", "Jardim Zanelatto", "Jardim Aquarius", "Bosque das Mansões", "Cruzeiro do Sul", "Loteamento Lisboa", "Residencial Nova São José", "São Luiz", "Zanelatto", "Alto Forquilhas", "Morro da Caixa", "Jardim Santiago"];

    document.getElementById("classe").addEventListener("change", function() {
      const especialidade = document.getElementById("especialidade");
      especialidade.innerHTML = '<option value="">Selecione</option>';
      (especialidadesPorClasse[this.value] || []).forEach(e => {
        const opt = document.createElement("option");
        opt.value = e;
        opt.textContent = e;
        especialidade.appendChild(opt);
      });
    });

    document.getElementById("cidade").addEventListener("change", function() {
      const cidade = this.value;
      const regiaoContainer = document.getElementById("regiaoContainer");
      const bairroSelect = document.getElementById("bairro");
      const regiaoSelect = document.getElementById("regiao");

      if (cidade === "florianopolis") {
        regiaoContainer.style.display = "block";
        bairroSelect.innerHTML = '<option value="">Selecione a região do bairro</option>';
      } else {
        regiaoContainer.style.display = "none";
        regiaoSelect.value = "";
        bairroSelect.innerHTML = '<option value="">Selecione</option>';
        bairrosSaoJose.forEach(bairro => {
          const option = document.createElement("option");
          option.value = bairro;
          option.textContent = bairro;
          bairroSelect.appendChild(option);
        });
      }
    });

    document.getElementById("regiao").addEventListener("change", function () {
      const bairroSelect = document.getElementById("bairro");
      bairroSelect.innerHTML = '<option value="">Selecione</option>';
      const bairros = bairrosPorRegiao[this.value] || [];
      bairros.forEach(bairro => {
        const option = document.createElement("option");
        option.value = bairro;
        option.textContent = bairro;
        bairroSelect.appendChild(option);
      });
    });

    document.getElementById("residencia").addEventListener("change", function () {
      const info = document.getElementById("apartamentoInfo");
      info.style.display = this.value === "apartamento" ? "block" : "none";
    });

    const statusCadastro = document.getElementById("statusCadastro");

    function atualizarStatus(message, type = "") {
      statusCadastro.textContent = message;
      statusCadastro.className = "show";
      if (type) {
        statusCadastro.classList.add(type);
      }
    }

    document.getElementById("cadastrarForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const aceite = document.getElementById("aceiteTermos").checked ? "Sim" : "Não";
      if (aceite === "Não") {
        alert("Você precisa ler e concordar com os Termos de Uso antes de continuar.");
        return;
      }

      const form = e.target;
      const data = new FormData(form);
      const obj = Object.fromEntries(data);
      obj.aceiteTermos = aceite;

      const email = String(obj.email || "").trim().toLowerCase();
      const senha = String(obj.senha || "");

      if (senha.length < 6) {
        atualizarStatus("A senha precisa ter no mínimo 6 caracteres.", "error");
        return;
      }

      const submitButton = form.querySelector('button[type="submit"]');
      submitButton.disabled = true;
      submitButton.textContent = "Cadastrando...";
      atualizarStatus("Criando sua conta e salvando seus dados...");

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, senha);
        const { uid } = cred.user;

        await setDoc(doc(db, "usuarios", uid), {
          uid,
          nome: obj.nome,
          email,
          telefone: obj.telefone,
          classe: obj.classe,
          especialidade: obj.especialidade,
          cidade: obj.cidade,
          regiao: obj.regiao || "",
          bairro: obj.bairro,
          residencia: obj.residencia,
          complemento: obj.complemento || "",
          rua: obj.rua,
          numero: obj.numero,
          disponibilidade: obj.disponibilidade,
          descricao: obj.descricao,
          diaria: obj.diaria,
          aceiteTermos: true,
          origemCadastro: "cadastrar.html",
          tipoUsuario: "cliente",
          criadoEm: serverTimestamp()
        });

        atualizarStatus("Cadastro realizado com sucesso! Seus dados foram salvos. Redirecionando para o login...", "success");
        form.reset();
        document.getElementById("especialidade").innerHTML = '<option value="">Selecione uma classe primeiro</option>';
        document.getElementById("bairro").innerHTML = '<option value="">Selecione a cidade primeiro</option>';
        document.getElementById("regiaoContainer").style.display = "none";
        document.getElementById("apartamentoInfo").style.display = "none";

        setTimeout(() => {
          window.location.href = "login.html";
        }, 1400);
      } catch (error) {
        let mensagemErro = "Não foi possível concluir o cadastro agora. Tente novamente.";

        if (error?.code === "auth/email-already-in-use") {
          mensagemErro = "Este e-mail já está em uso. Tente fazer login ou use outro e-mail.";
        } else if (error?.code === "auth/invalid-email") {
          mensagemErro = "Digite um e-mail válido para continuar.";
        } else if (error?.code === "auth/weak-password") {
          mensagemErro = "A senha informada é fraca. Use pelo menos 6 caracteres.";
        }

        atualizarStatus(mensagemErro, "error");
        console.error("Erro ao cadastrar profissional:", error);
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = "Cadastrar";
      }
    });
  </script>
</body>
</html>
