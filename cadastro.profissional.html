<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Help Floripa | Cadastro de Profissional</title>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif;}
body {background:#000; color:#fff; min-height:100vh; display:flex; flex-direction:column;}

.sidebar {width: 220px; background:#111; position:fixed; top:0; left:0; height:100%; padding:20px; display:flex; flex-direction:column; transition: transform 0.3s ease; z-index:1000;}
.sidebar h2 {color:#00adee; text-align:center; margin-bottom:25px; font-size:22px;}
.sidebar a {color:#fff; text-decoration:none; padding:12px; margin:6px 0; border-radius:6px; transition:0.3s; display:block;}
.sidebar a:hover {background:#00adee; color:#000;}

.main-content {margin-left:240px; padding:25px; transition: margin-left 0.3s; flex:1;}

.hero {background: linear-gradient(rgba(0,0,0,0.72), rgba(0,0,0,0.72)), url('assets/painel-cadastro.svg') center/cover no-repeat; height:280px; border-radius:15px; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; margin-bottom:35px; color:#00adee; font-size:26px; font-weight:bold; box-shadow: 0 0 20px rgba(0,173,238,0.5);}
.hero h1 {margin-bottom:10px; color:#fff;}
.hero span {font-size:17px; color:#c9f1ff;}

.form-container {background:#111; border:2px solid #00adee; border-radius:15px; padding:30px; max-width:650px; margin:auto; box-shadow: 0 0 20px rgba(0,173,238,0.3);}
.form-container h2 {text-align:center; color:#00adee; margin-bottom:20px;}
form {display:flex; flex-direction:column; gap:15px;}
label {font-weight:bold; color:#00adee;}
input, select, textarea {padding:10px; border:none; border-radius:8px; background:#222; color:#fff;}
input:focus, textarea:focus, select:focus {outline:2px solid #00adee;}
button {background:#00adee; color:#000; border:none; border-radius:8px; padding:12px; font-weight:bold; cursor:pointer; transition:0.3s;}
button:hover {background:#008cc7;}
button:disabled {background:#444; cursor:not-allowed;}

.info-box {background:#0d0d0d; border-left:4px solid #00adee; padding:15px; margin:25px auto; max-width:650px; border-radius:8px; font-size:14px; color:#ccc; line-height:1.5;}
.info-box strong {color:#00adee;}

.confirm-box {background:#0d0d0d; border:1px solid #00adee; border-radius:10px; padding:15px; color:#ccc; font-size:14px;}
.confirm-box label {color:#fff; font-weight:normal; cursor:pointer;}

#statusCadastro {display:none; margin-top:8px; padding:10px 12px; border-radius:8px; border:1px solid #1d3b52; background:#0f2233; color:#d8eef8; font-size:14px; line-height:1.4;}
#statusCadastro.show {display:block;}
#statusCadastro.success {border-color:#1f7a47; background:#0f2f1d; color:#bdf5d2;}
#statusCadastro.error {border-color:#8e2a2a; background:#351616; color:#ffd1d1;}

footer {background:#111; color:#aaa; text-align:center; padding:15px; font-size:13px; border-top:1px solid #222;}
footer a {color:#00adee; text-decoration:none; margin:0 8px;}
footer a:hover {text-decoration:underline;}

.menu-toggle {font-size:24px; cursor:pointer; color:#00adee; position:fixed; top:15px; left:15px; z-index:1100; display:none;}

@media(max-width:1024px){
    .main-content {margin-left:0; padding-top:60px;}
    .sidebar {transform: translateX(-250px);} 
    .sidebar.active {transform: translateX(0);} 
    .menu-toggle {display:block;}
}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <h2>Help Floripa</h2>
    <a href="index.html">In√≠cio</a>
    <a href="cliente.html">Cliente</a>
    <a href="profissional.html">Profissional</a>
    <a href="sobre.html">Sobre</a>
    <a href="contato.html">Contato</a>
</div>

<div class="menu-toggle" onclick="toggleSidebar()">‚ò∞</div>

<div class="main-content">
    <div class="hero">
        <h1>Cadastro de Profissional</h1>
        <span>Ganhe visibilidade e novos clientes na Help Floripa!</span>
    </div>

    <div class="info-box">
        <p><strong>Plano Profissional Premium:</strong> R$ 30,00 por m√™s.</p>
        <p>üí° Seu perfil ficar√° em destaque na plataforma, aumentando suas chances de contrata√ß√£o.</p>
        <p>üïí O pagamento √© mensal e pode ser encerrado a qualquer momento, sem multas ou fidelidade.</p>
    </div>

    <div class="form-container">
        <h2>Preencha o formul√°rio abaixo</h2>
        <form id="cadastroForm">
            <label for="nome">Nome completo</label>
            <input type="text" id="nome" name="nome" required>

            <label for="email">E-mail</label>
            <input type="email" id="email" name="email" placeholder="seunome@email.com" required>

            <label for="senha">Senha</label>
            <input type="password" id="senha" name="senha" minlength="6" placeholder="M√≠nimo 6 caracteres" required>

            <label for="telefone">Telefone / WhatsApp</label>
            <input type="tel" id="telefone" name="telefone" placeholder="(DDD) 9xxxx-xxxx" required>

            <label for="instagram">Instagram (opcional)</label>
            <input type="text" id="instagram" name="instagram" placeholder="@seuusuario">

            <label for="cpf">CPF ou CNPJ</label>
            <input type="text" id="cpf" name="cpfCnpj" placeholder="Somente n√∫meros" required>

            <label for="profissao">Profiss√£o</label>
            <input type="text" id="profissao" name="profissao" placeholder="Ex: Eletricista, Encanador, Pintor..." required>

            <label for="cidade">Cidade</label>
            <input type="text" id="cidade" name="cidade" placeholder="Ex: Florian√≥polis" required>

            <label for="bairro">Bairro</label>
            <input type="text" id="bairro" name="bairro" placeholder="Ex: Tapera" required>

            <label for="residencia">Tipo de resid√™ncia</label>
            <select id="residencia" name="residencia" required>
                <option value="">Selecione...</option>
                <option value="Casa">Casa</option>
                <option value="Apartamento">Apartamento</option>
            </select>

            <label for="bloco">Bloco e n√∫mero (se for apartamento)</label>
            <input type="text" id="bloco" name="bloco" placeholder="Ex: Bloco B, Apto 202">

            <label for="endereco">Rua e n√∫mero</label>
            <input type="text" id="endereco" name="endereco" placeholder="Ex: Rua das Palmeiras, 123" required>

            <label for="cnh">CNH (se for motorista)</label>
            <input type="text" id="cnh" name="cnh" placeholder="N√∫mero da CNH">

            <label for="categoria">Categoria da CNH</label>
            <select id="categoria" name="categoriaCnh">
                <option value="">Selecione...</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="AB">AB</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
            </select>

            <div class="confirm-box">
                <input type="checkbox" id="concordo" required>
                <label for="concordo">
                    Li e concordo com os <a href="termos.html" target="_blank" style="color:#00adee;">Termos de Compromisso</a>.<br>
                    ‚ö†Ô∏è Voc√™ receber√° um link via WhatsApp para realizar o pagamento do plano. Caso o pagamento n√£o seja efetuado, o cadastro ser√° <strong>cancelado automaticamente</strong>.
                </label>
            </div>

            <button type="submit" id="enviarBtn" disabled>Enviar Cadastro</button>
            <div id="statusCadastro" role="status" aria-live="polite"></div>
        </form>
    </div>
</div>

<footer>
    <p>CNPJ: 61.935.934/0001-00</p>
    <p>
        <a href="termos.html">Termos de Uso</a> |
        <a href="privacidade.html">Pol√≠tica de Privacidade</a>
    </p>
    <p>&copy; 2025 Help Floripa - Todos os direitos reservados.</p>
</footer>

<script type="module">
import { auth, db } from "./firebase.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { doc, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

function toggleSidebar(){
    document.getElementById('sidebar').classList.toggle('active');
}
window.toggleSidebar = toggleSidebar;

const concordo = document.getElementById("concordo");
const enviarBtn = document.getElementById("enviarBtn");
const statusCadastro = document.getElementById("statusCadastro");

function atualizarStatus(message, type = "") {
    statusCadastro.textContent = message;
    statusCadastro.className = "show";
    if (type) {
        statusCadastro.classList.add(type);
    }
}

concordo.addEventListener("change", function() {
    enviarBtn.disabled = !this.checked;
});

document.getElementById("cadastroForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    if (!concordo.checked) {
        atualizarStatus("Voc√™ precisa aceitar os termos para continuar.", "error");
        return;
    }

    const data = new FormData(e.target);
    const obj = Object.fromEntries(data);
    const email = String(obj.email || "").trim().toLowerCase();
    const senha = String(obj.senha || "");

    if (senha.length < 6) {
        atualizarStatus("A senha precisa ter no m√≠nimo 6 caracteres.", "error");
        return;
    }

    enviarBtn.disabled = true;
    enviarBtn.textContent = "Cadastrando...";
    atualizarStatus("Criando conta e salvando seus dados profissionais...");

    try {
        const cred = await createUserWithEmailAndPassword(auth, email, senha);
        const { uid } = cred.user;

        await setDoc(doc(db, "usuarios", uid), {
            uid,
            tipoUsuario: "profissional",
            nome: obj.nome,
            email,
            telefone: obj.telefone,
            instagram: obj.instagram || "",
            cpfCnpj: obj.cpfCnpj,
            profissao: obj.profissao,
            cidade: obj.cidade,
            bairro: obj.bairro,
            residencia: obj.residencia,
            bloco: obj.bloco || "",
            endereco: obj.endereco,
            cnh: obj.cnh || "",
            categoriaCnh: obj.categoriaCnh || "",
            aceiteTermos: true,
            plano: "Profissional Premium",
            valorPlanoMensal: 30,
            origemCadastro: "cadastro.profissional.html",
            criadoEm: serverTimestamp()
        });

        atualizarStatus("Cadastro profissional salvo com sucesso! Redirecionando para o login...", "success");
        e.target.reset();
        setTimeout(() => {
            window.location.href = "login.html";
        }, 1400);
    } catch (error) {
        let mensagemErro = "N√£o foi poss√≠vel concluir o cadastro agora. Tente novamente.";

        if (error?.code === "auth/email-already-in-use") {
            mensagemErro = "Este e-mail j√° est√° em uso. Tente fazer login ou use outro e-mail.";
        } else if (error?.code === "auth/invalid-email") {
            mensagemErro = "Digite um e-mail v√°lido para continuar.";
        } else if (error?.code === "auth/weak-password") {
            mensagemErro = "A senha informada √© fraca. Use pelo menos 6 caracteres.";
        }

        atualizarStatus(mensagemErro, "error");
        console.error("Erro ao cadastrar profissional:", error);
        enviarBtn.disabled = false;
    } finally {
        if (enviarBtn.textContent === "Cadastrando...") {
            enviarBtn.textContent = "Enviar Cadastro";
            enviarBtn.disabled = !concordo.checked;
        }
    }
});
</script>

</body>
    </html>
    
